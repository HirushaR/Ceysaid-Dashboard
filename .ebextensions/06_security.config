files:
  "/etc/nginx/conf.d/security.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Security configuration for Nginx
      
      # Block common bot attacks
      location ~* \.(asp|aspx|php|jsp|cgi)$ {
        return 404;
      }
      
      # Block access to sensitive files
      location ~ /\.(env|git|svn|hg|bzr) {
        return 404;
      }
      
      # Block access to backup files
      location ~ ~$ {
        return 404;
      }
      
      # Block access to common attack paths
      location ~ ^/(admin|administrator|wp-admin|phpmyadmin|mysql|sql|db|database) {
        return 404;
      }
      
      # Rate limiting for requests
      limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
      limit_req_zone $binary_remote_addr zone=login:10m rate=1r/s;
      
      # Apply rate limiting to API endpoints
      location /api/ {
        limit_req zone=api burst=20 nodelay;
        try_files $uri $uri/ /index.php?$query_string;
      }
      
      # Apply rate limiting to login endpoints
      location ~ ^/(login|admin/login) {
        limit_req zone=login burst=5 nodelay;
        try_files $uri $uri/ /index.php?$query_string;
      }

option_settings:
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx 